#!/bin/bash

# ----------------------------
# Путь к текущей папке с сайтом (где скрипт запущен)
# ----------------------------
SRC_DIR="$(pwd)"

# Папка сайта на сервере
REMOTE_PATH="/var/www/dmitrii.su/html"

# ----------------------------
# Проверка, что папка существует
# ----------------------------
if [ ! -d "$SRC_DIR" ]; then
    echo "Ошибка: текущая папка не найдена."
    exit 1
fi

# ----------------------------
# Создаём папку сайта на сервере, если её нет
# ----------------------------
sudo mkdir -p "$REMOTE_PATH"

# ----------------------------
# Копируем все файлы и папки, кроме самого скрипта
# ----------------------------
sudo rsync -av --exclude 'deploy_site.sh' --delete "$SRC_DIR"/ "$REMOTE_PATH"/

# ----------------------------
# Устанавливаем права для Nginx
# ----------------------------
sudo chown -R www-data:www-data "$REMOTE_PATH"
sudo chmod -R 755 "$REMOTE_PATH"

echo "Сайт успешно развернут в $REMOTE_PATH"
echo "Теперь все файлы доступны через HTTPS: https://dmitrii.su/"